# RAG Tool ä¼˜åŒ–æ€»ç»“

## ğŸ¯ ä¸»è¦æ”¹è¿›

### **1. æ™ºèƒ½ä½¿ç”¨å»ºè®® (`use_suggestion`)**
- **ç›®æ ‡**: ä¸ºä¸»æµç¨‹æä¾›å¯¹RAGç»“æœçš„æ™ºèƒ½åˆ†æå’Œå…·ä½“å»ºè®®
- **å®ç°**: åŸºäºLLMçš„ç»“æ„åŒ–åˆ†æï¼Œæå–å¯æ“ä½œçš„æ´å¯Ÿå’Œè§£å†³æ–¹æ¡ˆ

### **2. ç²¾ç¡®ç»“æœè®¡æ•° (`results_count`)**
- **æ”¹è¿›å‰**: åªè¿”å› 0 æˆ– 1ï¼ˆäºŒå…ƒçŠ¶æ€ï¼‰
- **æ”¹è¿›å**: è¿”å›å®é™…æ‰¾åˆ°çš„ç›¸ä¼¼é—®é¢˜æ•°é‡
- **å®ç°**: é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… `## ISSUE #` æ¨¡å¼

### **3. åŠ¨æ€ç½®ä¿¡åº¦è®¡ç®—**
- **æ”¹è¿›å‰**: å›ºå®šå€¼ 0.8 æˆ– 0.3
- **æ”¹è¿›å**: åŸºäºç»“æœæ•°é‡å’Œå†…å®¹è´¨é‡çš„åŠ¨æ€è®¡ç®—
- **å› ç´ **: ç»“æœæ•°é‡ã€æ˜¯å¦åŒ…å«è§£å†³æ–¹æ¡ˆã€é”™è¯¯ä¿¡æ¯ç­‰

## ğŸ“‹ æ–°å¢å­—æ®µç»“æ„

```json
{
    "context": "RAGæœç´¢çš„åŸå§‹ä¸Šä¸‹æ–‡",
    "results_count": 3,  // å®é™…æ‰¾åˆ°çš„é—®é¢˜æ•°é‡
    "is_successful": 1,  // æ˜¯å¦æˆåŠŸæ‰¾åˆ°ç»“æœ
    "confidence": 0.75,  // åŠ¨æ€è®¡ç®—çš„ç½®ä¿¡åº¦
    "use_suggestion": {
        "summary": "ç®€çŸ­æ€»ç»“å‘ç°çš„ç›¸ä¼¼é—®é¢˜",
        "relevance": "high|medium|low",
        "actionable_insights": [
            "å…·ä½“æ´å¯Ÿ1ï¼šæå–çš„è§£å†³æ–¹æ¡ˆç»†èŠ‚",
            "å…·ä½“æ´å¯Ÿ2ï¼šå¯æ“ä½œçš„æŒ‡å¯¼",
            "å…·ä½“æ´å¯Ÿ3ï¼šå®æ–½æ­¥éª¤"
        ],
        "recommended_approach": "åŸºäºå†å²è§£å†³æ–¹æ¡ˆçš„è¯¦ç»†å»ºè®®",
        "user_friendly_summary": "ç”¨æˆ·å‹å¥½çš„éæŠ€æœ¯æ€§è§£é‡Š"
    }
}
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½æ–¹æ³•

### **1. `_generate_use_suggestion()`**
- **LLMé©±åŠ¨åˆ†æ**: ä½¿ç”¨ä¸“é—¨çš„æç¤ºè¯åˆ†æRAGç»“æœ
- **ç»“æ„åŒ–è¾“å‡º**: è¿”å›æ ¼å¼åŒ–çš„å»ºè®®ç»“æ„
- **é”™è¯¯å¤„ç†**: LLMå¤±è´¥æ—¶çš„é™çº§å¤„ç†

### **2. `_build_analysis_prompt()`**
- **ä¸Šä¸‹æ–‡é™åˆ¶**: è‡ªåŠ¨æˆªæ–­é•¿å†…å®¹ä»¥é€‚åº”LLMé™åˆ¶
- **ä¸“ä¸šæŒ‡å¯¼**: èšç„¦äºæ¨¡å¼è¯†åˆ«ã€è§£å†³æ–¹æ¡ˆæå–ã€é£é™©è¯„ä¼°
- **ç”¨æˆ·å‹å¥½**: è¦æ±‚ç”ŸæˆéæŠ€æœ¯æ€§çš„æ‘˜è¦

### **3. `_calculate_confidence()`**
- **åŸºç¡€ç½®ä¿¡åº¦**: åŸºäºç»“æœæ•°é‡ (0.4 + results_count * 0.15)
- **è´¨é‡åŠ æˆ**: æ ¹æ®å†…å®¹åŒ…å«çš„å…³é”®è¯è°ƒæ•´
- **ä¸Šé™æ§åˆ¶**: æœ€é«˜ä¸è¶…è¿‡ 0.9

## ğŸ’¡ ä½¿ç”¨ä¼˜åŠ¿

### **å¯¹ä¸»æµç¨‹çš„ä»·å€¼**
1. **å‡å°‘è®¤çŸ¥è´Ÿæ‹…**: FinalAnalyzerå¯ä»¥ç›´æ¥ä½¿ç”¨ç»“æ„åŒ–å»ºè®®
2. **æå‡å“åº”è´¨é‡**: åŸºäºå†å²æ•°æ®çš„å…·ä½“å»ºè®®
3. **æ™ºèƒ½å†³ç­–æ”¯æŒ**: å¸®åŠ©åˆ¤æ–­æ˜¯å¦éœ€è¦å…¶ä»–å·¥å…·
4. **ç”¨æˆ·ä½“éªŒ**: æä¾›æ¸…æ™°ã€å¯æ“ä½œçš„å»ºè®®

### **æŠ€æœ¯ä¼˜åŠ¿**
1. **æ¨¡å—åŒ–è®¾è®¡**: RAGå·¥å…·è´Ÿè´£è§£é‡Šè‡ªå·±çš„ç»“æœ
2. **é”™è¯¯å®¹å¿**: LLMå¤±è´¥æ—¶çš„ä¼˜é›…é™çº§
3. **æ€§èƒ½ä¼˜åŒ–**: å†…å®¹æˆªæ–­é¿å…tokenæµªè´¹
4. **æ‰©å±•æ€§**: å…¶ä»–å·¥å…·å¯ä»¥é‡‡ç”¨ç›¸åŒæ¨¡å¼

## ğŸ”„ åœ¨FinalAnalyzerä¸­çš„ä½¿ç”¨

```python
# ç¤ºä¾‹ï¼šåœ¨FinalAnalyzerä¸­å¤„ç†RAGå·¥å…·çš„å»ºè®®
def _prepare_results_summary(self, tool_results: List[ToolResult]) -> str:
    for result in tool_results:
        if result.tool.value == "rag_search" and "use_suggestion" in result.data:
            suggestion = result.data["use_suggestion"]
            # ç›´æ¥ä½¿ç”¨ç»“æ„åŒ–çš„å»ºè®®ä¿¡æ¯
            summary_parts.append(f"""
**RAG Analysis** (Confidence: {result.confidence:.1%}):
- Found: {suggestion['summary']}
- Relevance: {suggestion['relevance']}
- Key Insights: {', '.join(suggestion['actionable_insights'])}
- Recommendation: {suggestion['recommended_approach']}
""")
```

## ğŸ“Š æœŸæœ›æ•ˆæœ

1. **æ›´æ™ºèƒ½çš„åˆ†æ**: RAGå·¥å…·ä¸ä»…è¿”å›æ•°æ®ï¼Œè¿˜æä¾›è§£è¯»
2. **æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ**: åŸºäºå†å²æ¡ˆä¾‹çš„å…·ä½“å»ºè®®
3. **æ›´é«˜çš„æ•ˆç‡**: å‡å°‘ä¸»æµç¨‹çš„åˆ†æè´Ÿæ‹…
4. **æ›´å¼ºçš„æ‰©å±•æ€§**: ä¸ºå…¶ä»–å·¥å…·å»ºç«‹äº†æ¨¡å¼æ ‡å‡†

è¿™ä¸ªä¼˜åŒ–å°†ä½¿RAGå·¥å…·ä»ç®€å•çš„æ•°æ®æä¾›è€…è½¬å˜ä¸ºæ™ºèƒ½çš„åˆ†æåŠ©æ‰‹ï¼Œæ˜¾è‘—æå‡æ•´ä¸ªç³»ç»Ÿçš„æ™ºèƒ½æ°´å¹³ã€‚
